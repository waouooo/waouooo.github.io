<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.110.0"><meta name=generator content="Relearn 5.10.2+tip"><meta name=description content="一个很哇塞的博客"><meta name=author content="waouooo"><title>Hugo+Github Pages快速搭建个人博客三：Github Actions自动部署 :: waouooo</title><link href=https://waouooo.github.io/kuai-su-jian-zhan-202856/step3/index.html rel=canonical type=text/html title="Hugo+Github Pages快速搭建个人博客三：Github Actions自动部署 :: waouooo"><link href=../../kuai-su-jian-zhan-202856/step3/index.xml rel=alternate type=application/rss+xml title="Hugo+Github Pages快速搭建个人博客三：Github Actions自动部署 :: waouooo"><link href=../../images/favicon.png?1676445207 rel=icon type=image/png><link href=../../css/fontawesome-all.min.css?1676445207 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../css/fontawesome-all.min.css?1676445207 rel=stylesheet></noscript><link href=../../css/auto-complete.css?1676445207 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../css/auto-complete.css?1676445207 rel=stylesheet></noscript><link href=../../css/perfect-scrollbar.min.css?1676445207 rel=stylesheet><link href=../../css/nucleus.css?1676445207 rel=stylesheet><link href=../../css/fonts.css?1676445207 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../css/fonts.css?1676445207 rel=stylesheet></noscript><link href=../../css/theme.css?1676445207 rel=stylesheet><link href=../../css/theme-relearn-light.css?1676445207 rel=stylesheet id=variant-style><link href=../../css/ie.css?1676445207 rel=stylesheet><link href=../../css/variant.css?1676445207 rel=stylesheet><link href=../../css/print.css?1676445207 rel=stylesheet media=print><link href=../../css/format-print.css?1676445207 rel=stylesheet><script src=../../js/url.js?1676445207></script>
<script src=../../js/variant.js?1676445207></script>
<script>window.index_js_url="../../index.search.js";var root_url="../../",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="Copy to clipboard",window.T_Copied_to_clipboard="Copied to clipboard!",window.T_Copy_link_to_clipboard="Copy link to clipboard",window.T_Link_copied_to_clipboard="Copied link to clipboard!",window.T_No_results_found="No results found for \u0022{0}\u0022",window.T_N_results_found="{1} results found for \u0022{0}\u0022",baseUriFull="https://waouooo.github.io/",window.variants&&variants.init(["relearn-light","relearn-dark","learn","neon","blue","green","red"])</script><script src=../../js/jquery.min.js?1676445207 defer></script></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=../../kuai-su-jian-zhan-202856/step3/index.html><div id=body class=default-animation><div id=sidebar-overlay></div><div id=toc-overlay></div><nav id=topbar class=highlightable dir=ltr><div><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a></span><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../index.html><span itemprop=name>waouooo</span></a><meta itemprop=position content="1">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../kuai-su-jian-zhan-202856/index.html><span itemprop=name>快速建站</span></a><meta itemprop=position content="2">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Hugo+Github Pages快速搭建个人博客三：Github Actions自动部署</span><meta itemprop=position content="3"></li></ol></div></div></nav><main id=body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><div id=head-tags><div class=tags><a class=tag-link href=../../tags/github-actions/index.html>Github Actions</a>
<a class=tag-link href=../../tags/github-pages/index.html>Github Pages</a>
<a class=tag-link href=../../tags/hugo/index.html>Hugo</a>
<a class=tag-link href=../../tags/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/index.html>个人博客</a>
<a class=tag-link href=../../tags/%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%99/index.html>快速建站</a></div></div><article class=default><h1 id=hugogithub-pages快速搭建个人博客三github-actions自动部署>Hugo+Github Pages快速搭建个人博客三：Github Actions自动部署</h1><h3 id=前言>前言</h3><p>通过之前的文章，我们已经把博客站点部署完成，并且添加了giscus评论系统，但是每次发布文章都需要手动执行<code>hugo</code>命令生成站点静态文件，并把文件推送到仓库当中等待部署才能发布。为了简化我们的发布流程，本文将介绍使用Github Actions 来自动构建hugo静态文件，并推送至启用github pages的仓库当中。</p><h4 id=1-创建站点文章仓库>1. 创建站点文章仓库</h4><p>在第一篇中我们只在github上创建了waouooo.github.io仓库，用于保存站点的静态文件，并开启Github Pages。但是我们在使用<code>hugo new site waouooo</code>创建站点文件夹时也对站点文件夹做了git init 操作，因此我们也可以将站点的内容保存至github中。<a href=https://github.com/new target=_blank>点此创建</a></p><p><a href=#0-https--raw-githubusercontent-com-zhou-yi-git-picture-bed-master-images-202301-20230208173757-png><img src=https://raw.githubusercontent.com/zhou-yi-git/picture-bed/master/images/202301/20230208173757.png alt style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=0-https--raw-githubusercontent-com-zhou-yi-git-picture-bed-master-images-202301-20230208173757-png><img src=https://raw.githubusercontent.com/zhou-yi-git/picture-bed/master/images/202301/20230208173757.png alt loading=lazy></a></p><h4 id=2-关联远程仓库至本地hugo-站点元数据git仓库并推送>2. 关联远程仓库至本地hugo 站点元数据git仓库，并推送</h4><p>仓库创建完成之后github页面会展示以下内容：
<a href=#0-https--raw-githubusercontent-com-zhou-yi-git-picture-bed-master-images-202301-20230208174949-png><img src=https://raw.githubusercontent.com/zhou-yi-git/picture-bed/master/images/202301/20230208174949.png alt style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=0-https--raw-githubusercontent-com-zhou-yi-git-picture-bed-master-images-202301-20230208174949-png><img src=https://raw.githubusercontent.com/zhou-yi-git/picture-bed/master/images/202301/20230208174949.png alt loading=lazy></a>
因为我们本地已经有仓库，只需要执行以下内容即可：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git remote add origin git@github.com:waouooo/myblog.git
</span></span><span class=line><span class=cl>git push -u origin master
</span></span></code></pre></div><h4 id=3-生成sshkey-用于github-actions推送hugo生成的静态文件至托管仓库>3. 生成sshkey 用于Github Actions推送hugo生成的静态文件至托管仓库</h4><p>-C 参数指定github用户的邮箱</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ssh-keygen -t rsa -C waouooo@163.com
</span></span><span class=line><span class=cl><span class=c1># 以下内容为输出</span>
</span></span><span class=line><span class=cl>Generating public/private rsa key pair.
</span></span><span class=line><span class=cl><span class=c1># 此处输入保存新ssh key的文件路径,不要回车，否则使用默认文件名，会被覆盖。其他地方可一路回车</span>
</span></span><span class=line><span class=cl>Enter file in which to save the key <span class=o>(</span>/Users/waouooo/.ssh/id_rsa<span class=o>)</span>: id_rsa_deploy_key
</span></span><span class=line><span class=cl>Enter passphrase <span class=o>(</span>empty <span class=k>for</span> no passphrase<span class=o>)</span>:
</span></span><span class=line><span class=cl>Enter same passphrase again:
</span></span><span class=line><span class=cl>Your identification has been saved in id_rsa_deploy_key
</span></span><span class=line><span class=cl>Your public key has been saved in id_rsa_deploy_key.pub
</span></span><span class=line><span class=cl>The key fingerprint is:
</span></span><span class=line><span class=cl>SHA256:iKKuSQt+jFiZc3UbeSDY………………tYrvgO+FRI7tSE waouooo@163.com
</span></span><span class=line><span class=cl>The key<span class=err>&#39;</span>s randomart image is:
</span></span><span class=line><span class=cl>+---<span class=o>[</span>RSA 3072<span class=o>]</span>----+
</span></span><span class=line><span class=cl><span class=p>|</span>     o           <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span>    . o .        <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     + . oE o    <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span>    o.o.<span class=o>=</span> .<span class=o>=</span> o   <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span>  .+.o. <span class=nv>S</span><span class=o>=</span>+.o.   <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> .<span class=o>=</span>.o . . <span class=o>=</span>o+..  <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span>+o o     o O.  . <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span>*o.o      +.+ .  <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span>++.       .oo+   <span class=p>|</span>
</span></span><span class=line><span class=cl>+----<span class=o>[</span>SHA256<span class=o>]</span>-----+
</span></span></code></pre></div><p>以上执行完成之后会在当前目录生成 <code>id_rsa_deploy_key</code>, <code>id_rsa_deploy_key.pub</code>两个文件</p><h4 id=4-将生成的公钥-id_rsa_deploy_keypub-保存至需要部署的waouooogithubio项目中>4. 将生成的公钥: id_rsa_deploy_key.pub 保存至需要部署的waouooo.github.io项目中</h4><p><a href=#0-https--raw-githubusercontent-com-zhou-yi-git-picture-bed-master-images-202301-20230208181630-png><img src=https://raw.githubusercontent.com/zhou-yi-git/picture-bed/master/images/202301/20230208181630.png alt style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=0-https--raw-githubusercontent-com-zhou-yi-git-picture-bed-master-images-202301-20230208181630-png><img src=https://raw.githubusercontent.com/zhou-yi-git/picture-bed/master/images/202301/20230208181630.png alt loading=lazy></a></p><p><a href=#0-https--raw-githubusercontent-com-zhou-yi-git-picture-bed-master-images-202301-20230208181946-png><img src=https://raw.githubusercontent.com/zhou-yi-git/picture-bed/master/images/202301/20230208181946.png alt style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=0-https--raw-githubusercontent-com-zhou-yi-git-picture-bed-master-images-202301-20230208181946-png><img src=https://raw.githubusercontent.com/zhou-yi-git/picture-bed/master/images/202301/20230208181946.png alt loading=lazy></a></p><h4 id=5-使用ssh私钥-id_rsa_deploy_key-在站点元数据仓库中创建secret>5. 使用ssh私钥: id_rsa_deploy_key 在站点元数据仓库中创建secret</h4><p><a href=#0-https--raw-githubusercontent-com-zhou-yi-git-picture-bed-master-images-202301-20230208182143-png><img src=https://raw.githubusercontent.com/zhou-yi-git/picture-bed/master/images/202301/20230208182143.png alt style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=0-https--raw-githubusercontent-com-zhou-yi-git-picture-bed-master-images-202301-20230208182143-png><img src=https://raw.githubusercontent.com/zhou-yi-git/picture-bed/master/images/202301/20230208182143.png alt loading=lazy></a>
<font color=#FF0000>Name建议使用DEPLOY_KEY， 需要下文Github Actions 的Workflow配置文件中使用</font>
<a href=#0-https--raw-githubusercontent-com-zhou-yi-git-picture-bed-master-images-202301-20230208182335-png><img src=https://raw.githubusercontent.com/zhou-yi-git/picture-bed/master/images/202301/20230208182335.png alt style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=0-https--raw-githubusercontent-com-zhou-yi-git-picture-bed-master-images-202301-20230208182335-png><img src=https://raw.githubusercontent.com/zhou-yi-git/picture-bed/master/images/202301/20230208182335.png alt loading=lazy></a></p><h4 id=6-创建github-actions-的工作流workflow>6. 创建Github Actions 的工作流(workflow)</h4><p><a href=#0-https--raw-githubusercontent-com-zhou-yi-git-picture-bed-master-images-202301-20230208183033-png><img src=https://raw.githubusercontent.com/zhou-yi-git/picture-bed/master/images/202301/20230208183033.png alt style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=0-https--raw-githubusercontent-com-zhou-yi-git-picture-bed-master-images-202301-20230208183033-png><img src=https://raw.githubusercontent.com/zhou-yi-git/picture-bed/master/images/202301/20230208183033.png alt loading=lazy></a></p><p>将以下内容填充至配置中:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>GitHub Pages</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>master </span><span class=w> </span><span class=c># Set a branch to deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-22.04</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>concurrency</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>group</span><span class=p>:</span><span class=w> </span><span class=l>${{ github.workflow }}-${{ github.ref }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>submodules</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>  </span><span class=c># Fetch Hugo themes (true OR recursive)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>fetch-depth</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>    </span><span class=c># Fetch all history for .GitInfo and .Lastmod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Setup Hugo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>peaceiris/actions-hugo@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>hugo-version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;latest&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>extended</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>hugo --minify</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>peaceiris/actions-gh-pages@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>${{ github.ref == &#39;refs/heads/master&#39; }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=nt>deploy_key</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.DEPLOY_KEY }} </span><span class=w> </span><span class=c># 上文保存至本仓库secrets中的ssh秘钥变量名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=nt>external_repository</span><span class=p>:</span><span class=w> </span><span class=l>waouooo/waouooo.github.io</span><span class=w> </span><span class=c># 需要将静态文件推送的仓库名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=nt>publish_branch</span><span class=p>:</span><span class=w> </span><span class=l>main</span><span class=w> </span><span class=c># 对应目的仓库的目的分支，因为waouooo主分支为main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=nt>publish_dir</span><span class=p>:</span><span class=w> </span><span class=l>./public</span><span class=w> </span><span class=c># 推送的文件夹，hugo --minify命令会将静态文件生成至./public文件夹中</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=nt>commit_message</span><span class=p>:</span><span class=w> </span><span class=l>${{ github.event.head_commit.message }}</span><span class=w> </span><span class=c># 指定commit信息</span><span class=w>
</span></span></span></code></pre></div><p><a href=#0-https--raw-githubusercontent-com-zhou-yi-git-picture-bed-master-images-202301-20230208183603-png><img src=https://raw.githubusercontent.com/zhou-yi-git/picture-bed/master/images/202301/20230208183603.png alt style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=0-https--raw-githubusercontent-com-zhou-yi-git-picture-bed-master-images-202301-20230208183603-png><img src=https://raw.githubusercontent.com/zhou-yi-git/picture-bed/master/images/202301/20230208183603.png alt loading=lazy></a></p><p>完成后点击start commit完成配置
<a href=#0-https--raw-githubusercontent-com-zhou-yi-git-picture-bed-master-images-202301-20230208183640-png><img src=https://raw.githubusercontent.com/zhou-yi-git/picture-bed/master/images/202301/20230208183640.png alt style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=0-https--raw-githubusercontent-com-zhou-yi-git-picture-bed-master-images-202301-20230208183640-png><img src=https://raw.githubusercontent.com/zhou-yi-git/picture-bed/master/images/202301/20230208183640.png alt loading=lazy></a></p><blockquote><p>注意：此时仓库中提交了一个.github/workflows/main.yml的新文件，需要使用git pull 同步至本仓库先，方式下次推送时发生冲突</p></blockquote><h3 id=总结>总结</h3><p>至此自动化推送已经实现，之后只需要添加文章之后将其推送到远端仓库即可自动触发Github Actions执行自动编译并推送至站点仓库waouooo.github.io中</p><h3 id=参考链接>参考链接</h3><p><a href=https://github.com/marketplace/actions/hugo-setup target=_blank>Hugo setup</a></p><p><a href=https://github.com/peaceiris/actions-gh-pages target=_blank>actions-gh-pages</a></p><footer class=footline><div><style>#comment{padding:8rem 0 2rem}#comment .vemoji{max-width:1.5em;max-height:1.5em}</style><div id=comment><script src=https://giscus.app/client.js data-repo=waouooo/waouooo.github.io data-repo-id=R_kgDOI25j-A data-category=General data-category-id=DIC_kwDOI25j-M4CT3hG data-mapping=pathname data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=dark data-lang=zh-CN crossorigin=anonymous data-term=1046 async></script></div><noscript>Please enable JavaScript to view the comments powered by giscus.</noscript></div></footer></article></div></main></div><script src=../../js/clipboard.min.js?1676445207 defer></script>
<script src=../../js/perfect-scrollbar.min.js?1676445207 defer></script>
<script src=../../js/featherlight.min.js?1676445207 defer></script>
<script src=../../js/theme.js?1676445207 defer></script></body></html>